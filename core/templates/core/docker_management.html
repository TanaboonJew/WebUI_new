{% extends 'base.html' %}
{% load crispy_forms_tags %}
{{ dockerfile_form|crispy }}
{{ image_form|crispy }}

{% block content %}
<div class="container mt-4">
    <h2>Docker Management</h2>

    {% if container %}
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span>Your Container</span>
            <div class="btn-group">
                {% if container.status == 'running' %}
                    <form method="post" action="{% url 'stop-container' %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-warning btn-sm">Stop</button>
                    </form>
                {% else %}
                    <form method="post" action="{% url 'start-container' %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success btn-sm">Start</button>
                    </form>
                {% endif %}
                <form method="post" action="{% url 'delete-container' %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm"
                            onclick="return confirm('Are you sure you want to delete this container?')">
                        Delete
                    </button>
                </form>
            </div>
        </div>
        <div class="card-body">
            <p><strong>Image:</strong> {{ container.image_name }}</p>
            <p><strong>Status:</strong>
                <span class="badge bg-{% if container.status == 'running' %}success{% else %}warning{% endif %}">
                    {{ container.status }}
                </span>
            </p>
            {% if container.status == 'running' and container.port_bindings.80_tcp %}
                <p><strong>Access URL:</strong> http://localhost:{{ container.port_bindings.80_tcp }}</p>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Upload Dockerfile -->
    <div class="card mt-4 shadow-sm">
        <div class="card-header bg-info text-white d-flex align-items-center">
            <i class="fas fa-file-code me-2"></i>
            <h5 class="mb-0">Build from Dockerfile</h5>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                {% csrf_token %}
                <input type="hidden" name="form_type" value="dockerfile">
                {{ dockerfile_form|crispy }}
                <button type="submit" class="btn btn-info mt-3 d-flex align-items-center">
                    <i class="fas fa-cogs me-2"></i>
                    Build Container
                </button>
            </form>
        </div>
    </div>

    <!-- Pull Image from DockerHub -->
    <div class="card mt-4 shadow-sm">
        <div class="card-header bg-secondary text-white d-flex align-items-center">
            <i class="fab fa-docker me-2"></i>
            <h5 class="mb-0">Use DockerHub Image</h5>
        </div>
        <div class="card-body">
            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}
                <input type="hidden" name="form_type" value="image">
                {{ image_form|crispy }}
                <button type="submit" class="btn btn-secondary mt-3 d-flex align-items-center">
                    <i class="fas fa-download me-2"></i>
                    Pull & Create Container
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
